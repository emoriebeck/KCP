tmp <- tibble(r = .8, tmp = "C-A", i = 50, G = ifelse(G_k < .01, sprintf("%.2e", G_k), sprintf("%.1f", G_k)))
mw_cor %>%
ggplot(aes(x = i, y = r, color = tmp)) +
scale_y_continuous(limits = c(-1.1,1.1), breaks = seq(-1,1,1)) +
scale_x_continuous(limits = c(1,55), breaks = c(1,seq(5,55,5))) +
# geom_rect(aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax),
#   fill = "khaki1", alpha = .5, color = "white") +
geom_line() +
geom_point(data = . %>% filter(i == R_i), size = 4) +
geom_point(data = . %>% filter(i == R_j), size = 4) +
geom_text(data = . %>% filter(i == R_i), aes(label = round(r, 1), y = ifelse(r > 0, r - .6, r + .6))) +
geom_text(data = . %>% filter(i == R_j), aes(label = round(r, 1), y = ifelse(r > 0, r - .6, r + .6))) +
geom_label(data = tmp, aes(label = sprintf("G_k = %.1e", G)), color = "black") +
# annotate("text", x = 55, y = 1, label = round(G_k,1)) +
labs(x = "Week", y = "Moving window Correlation") +
facet_wrap(~tmp, ncol = 1, strip.position = "right") +
theme_classic() +
theme(legend.position = "none",
strip.text = element_text(face = "bold", angle = 0, size = rel(1.3)),
axis.text = element_text(face = "bold"),
axis.title = element_text(face = "bold", size = rel(1.2)))
}
gausssim_short_plot_fun(inner$inner_l[i], inner$outer_l[i], inner$inner[i])
G_k = .001
ifelse(G_k < .01, sprintf("%.2e", G_k), sprintf("%.1f", G_k))
tmp <- tibble(r = .8, tmp = "C-A", i = 50, G = ifelse(G_k < .01, sprintf("%.2e", G_k), sprintf("%.1f", G_k)))
gausssim_short_plot_fun <- function(R_i, R_j, G_k){
tmp <- tibble(r = .8, tmp = "C-A", i = 50, G = ifelse(G_k < .01, sprintf("%.2e", G_k), sprintf("%.1f", G_k)))
mw_cor %>%
ggplot(aes(x = i, y = r, color = tmp)) +
scale_y_continuous(limits = c(-1.1,1.1), breaks = seq(-1,1,1)) +
scale_x_continuous(limits = c(1,55), breaks = c(1,seq(5,55,5))) +
# geom_rect(aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax),
#   fill = "khaki1", alpha = .5, color = "white") +
geom_line() +
geom_point(data = . %>% filter(i == R_i), size = 4) +
geom_point(data = . %>% filter(i == R_j), size = 4) +
geom_text(data = . %>% filter(i == R_i), aes(label = round(r, 1), y = ifelse(r > 0, r - .6, r + .6))) +
geom_text(data = . %>% filter(i == R_j), aes(label = round(r, 1), y = ifelse(r > 0, r - .6, r + .6))) +
geom_label(data = tmp, aes(label = G), color = "black") +
# annotate("text", x = 55, y = 1, label = round(G_k,1)) +
labs(x = "Week", y = "Moving window Correlation") +
facet_wrap(~tmp, ncol = 1, strip.position = "right") +
theme_classic() +
theme(legend.position = "none",
strip.text = element_text(face = "bold", angle = 0, size = rel(1.3)),
axis.text = element_text(face = "bold"),
axis.title = element_text(face = "bold", size = rel(1.2)))
}
gausssim_short_plot_fun(inner$inner_l[i], inner$outer_l[i], inner$inner[i])
G_k
ifelse(G_k < .01, sprintf("%.2e", G_k), sprintf("%.1f", G_k))
mw_cor %>%
ggplot(aes(x = i, y = r, color = tmp)) +
scale_y_continuous(limits = c(-1.1,1.1), breaks = seq(-1,1,1)) +
scale_x_continuous(limits = c(1,55), breaks = c(1,seq(5,55,5))) +
# geom_rect(aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax),
#   fill = "khaki1", alpha = .5, color = "white") +
geom_line() +
geom_point(data = . %>% filter(i == R_i), size = 4) +
geom_point(data = . %>% filter(i == R_j), size = 4) +
geom_text(data = . %>% filter(i == R_i), aes(label = round(r, 1), y = ifelse(r > 0, r - .6, r + .6))) +
geom_text(data = . %>% filter(i == R_j), aes(label = round(r, 1), y = ifelse(r > 0, r - .6, r + .6))) +
geom_label(data = tmp, aes(label = G), color = "black") +
# annotate("text", x = 55, y = 1, label = round(G_k,1)) +
labs(x = "Week", y = "Moving window Correlation") +
facet_wrap(~tmp, ncol = 1, strip.position = "right") +
theme_classic() +
theme(legend.position = "none",
strip.text = element_text(face = "bold", angle = 0, size = rel(1.3)),
axis.text = element_text(face = "bold"),
axis.title = element_text(face = "bold", size = rel(1.2)))
R_i <- inner$inner_l[i]
R_j <- inner$outer_l[i]
G_k <- inner$inner[i]
tmp <- tibble(r = .8, tmp = "C-A", i = 50, G = ifelse(G_k < .01, sprintf("%.2e", G_k), sprintf("%.1f", G_k)))
mw_cor %>%
ggplot(aes(x = i, y = r, color = tmp)) +
scale_y_continuous(limits = c(-1.1,1.1), breaks = seq(-1,1,1)) +
scale_x_continuous(limits = c(1,55), breaks = c(1,seq(5,55,5))) +
# geom_rect(aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax),
#   fill = "khaki1", alpha = .5, color = "white") +
geom_line() +
geom_point(data = . %>% filter(i == R_i), size = 4) +
geom_point(data = . %>% filter(i == R_j), size = 4) +
geom_text(data = . %>% filter(i == R_i), aes(label = round(r, 1), y = ifelse(r > 0, r - .6, r + .6))) +
geom_text(data = . %>% filter(i == R_j), aes(label = round(r, 1), y = ifelse(r > 0, r - .6, r + .6))) +
geom_label(data = tmp, aes(label = G), color = "black") +
# annotate("text", x = 55, y = 1, label = round(G_k,1)) +
labs(x = "Week", y = "Moving window Correlation") +
facet_wrap(~tmp, ncol = 1, strip.position = "right") +
theme_classic() +
theme(legend.position = "none",
strip.text = element_text(face = "bold", angle = 0, size = rel(1.3)),
axis.text = element_text(face = "bold"),
axis.title = element_text(face = "bold", size = rel(1.2)))
G_k
tmp <- tibble(r = .8, tmp = "C-A", i = 50, G = ifelse(G_k < .1, sprintf("%.2e", G_k), sprintf("%.1f", G_k)))
mw_cor %>%
ggplot(aes(x = i, y = r, color = tmp)) +
scale_y_continuous(limits = c(-1.1,1.1), breaks = seq(-1,1,1)) +
scale_x_continuous(limits = c(1,55), breaks = c(1,seq(5,55,5))) +
# geom_rect(aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax),
#   fill = "khaki1", alpha = .5, color = "white") +
geom_line() +
geom_point(data = . %>% filter(i == R_i), size = 4) +
geom_point(data = . %>% filter(i == R_j), size = 4) +
geom_text(data = . %>% filter(i == R_i), aes(label = round(r, 1), y = ifelse(r > 0, r - .6, r + .6))) +
geom_text(data = . %>% filter(i == R_j), aes(label = round(r, 1), y = ifelse(r > 0, r - .6, r + .6))) +
geom_label(data = tmp, aes(label = G), color = "black") +
# annotate("text", x = 55, y = 1, label = round(G_k,1)) +
labs(x = "Week", y = "Moving window Correlation") +
facet_wrap(~tmp, ncol = 1, strip.position = "right") +
theme_classic() +
theme(legend.position = "none",
strip.text = element_text(face = "bold", angle = 0, size = rel(1.3)),
axis.text = element_text(face = "bold"),
axis.title = element_text(face = "bold", size = rel(1.2)))
tmp <- tibble(r = .8, tmp = "C-A", i = 50, G = ifelse(G_k < .1, sprintf("%.1e", G_k), sprintf("%.1f", G_k)))
mw_cor %>%
ggplot(aes(x = i, y = r, color = tmp)) +
scale_y_continuous(limits = c(-1.1,1.1), breaks = seq(-1,1,1)) +
scale_x_continuous(limits = c(1,55), breaks = c(1,seq(5,55,5))) +
# geom_rect(aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax),
#   fill = "khaki1", alpha = .5, color = "white") +
geom_line() +
geom_point(data = . %>% filter(i == R_i), size = 4) +
geom_point(data = . %>% filter(i == R_j), size = 4) +
geom_text(data = . %>% filter(i == R_i), aes(label = round(r, 1), y = ifelse(r > 0, r - .6, r + .6))) +
geom_text(data = . %>% filter(i == R_j), aes(label = round(r, 1), y = ifelse(r > 0, r - .6, r + .6))) +
geom_label(data = tmp, aes(label = G), color = "black") +
# annotate("text", x = 55, y = 1, label = round(G_k,1)) +
labs(x = "Week", y = "Moving window Correlation") +
facet_wrap(~tmp, ncol = 1, strip.position = "right") +
theme_classic() +
theme(legend.position = "none",
strip.text = element_text(face = "bold", angle = 0, size = rel(1.3)),
axis.text = element_text(face = "bold"),
axis.title = element_text(face = "bold", size = rel(1.2)))
gausssim_short_plot_fun <- function(R_i, R_j, G_k){
tmp <- tibble(r = .8, tmp = "C-A", i = 50, G = ifelse(G_k < .1, sprintf("%.1e", G_k), sprintf("%.1f", G_k)))
mw_cor %>%
ggplot(aes(x = i, y = r, color = tmp)) +
scale_y_continuous(limits = c(-1.1,1.1), breaks = seq(-1,1,1)) +
scale_x_continuous(limits = c(1,55), breaks = c(1,seq(5,55,5))) +
# geom_rect(aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax),
#   fill = "khaki1", alpha = .5, color = "white") +
geom_line() +
geom_point(data = . %>% filter(i == R_i), size = 4) +
geom_point(data = . %>% filter(i == R_j), size = 4) +
geom_text(data = . %>% filter(i == R_i), aes(label = round(r, 1), y = ifelse(r > 0, r - .6, r + .6))) +
geom_text(data = . %>% filter(i == R_j), aes(label = round(r, 1), y = ifelse(r > 0, r - .6, r + .6))) +
geom_label(data = tmp, aes(label = G), color = "black") +
# annotate("text", x = 55, y = 1, label = round(G_k,1)) +
labs(x = "Week", y = "Moving window Correlation") +
facet_wrap(~tmp, ncol = 1, strip.position = "right") +
theme_classic() +
theme(legend.position = "none",
strip.text = element_text(face = "bold", angle = 0, size = rel(1.3)),
axis.text = element_text(face = "bold"),
axis.title = element_text(face = "bold", size = rel(1.2)))
}
gausssim_short_plot_fun <- function(R_i, R_j, G_k){
tmp <- tibble(r = .8, tmp = "C-A", i = 48, G = ifelse(G_k < .1, sprintf("%.1e", G_k), sprintf("%.1f", G_k)))
mw_cor %>%
ggplot(aes(x = i, y = r, color = tmp)) +
scale_y_continuous(limits = c(-1.1,1.1), breaks = seq(-1,1,1)) +
scale_x_continuous(limits = c(1,55), breaks = c(1,seq(5,55,5))) +
# geom_rect(aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax),
#   fill = "khaki1", alpha = .5, color = "white") +
geom_line() +
geom_point(data = . %>% filter(i == R_i), size = 4) +
geom_point(data = . %>% filter(i == R_j), size = 4) +
geom_text(data = . %>% filter(i == R_i), aes(label = round(r, 1), y = ifelse(r > 0, r - .6, r + .6))) +
geom_text(data = . %>% filter(i == R_j), aes(label = round(r, 1), y = ifelse(r > 0, r - .6, r + .6))) +
geom_label(data = tmp, aes(label = G), color = "black") +
# annotate("text", x = 55, y = 1, label = round(G_k,1)) +
labs(x = "Week", y = "Moving window Correlation") +
facet_wrap(~tmp, ncol = 1, strip.position = "right") +
theme_classic() +
theme(legend.position = "none",
strip.text = element_text(face = "bold", angle = 0, size = rel(1.3)),
axis.text = element_text(face = "bold"),
axis.title = element_text(face = "bold", size = rel(1.2)))
}
loop.animate <- function() {
lapply(1:nrow(inner), function(i){
gausssim_short_plot_fun(inner$inner_l[i], inner$outer_l[i], inner$inner[i])
})
}
saveGIF(loop.animate(), interval = .1, movie.name="gaussim_series_short.gif", ani.width = 800, ani.height = 500)
1:nrow(inner)
tau_p <- 35
tau_p_min_1 <- 25
R <- mw_cor %>% group_by(i) %>% select(-tmp) %>% nest()
inner <- crossing(inner_l = (tau_p_min_1+1):tau_p,
outer_l = (tau_p_min_1+1):tau_p) %>%
filter(inner_l != outer_l & inner_l < outer_l) %>%
left_join(R %>% dplyr::select(inner_l = i, R_i = data)) %>%
left_join(R %>% dplyr::select(outer_l = i, R_j = data)) %>%
mutate(inner = map2_dbl(R_i, R_j, possibly(gauss_kernal_fun, NA_real_)))
gausssim_short_plot_fun <- function(R_i, R_j, G_k){
tmp <- tibble(r = .8, tmp = "C-A", i = 48, G = ifelse(G_k < .1, sprintf("%.1e", G_k), sprintf("%.1f", G_k)))
mw_cor %>%
ggplot(aes(x = i, y = r, color = tmp)) +
scale_y_continuous(limits = c(-1.1,1.1), breaks = seq(-1,1,1)) +
scale_x_continuous(limits = c(1,55), breaks = c(1,seq(5,55,5))) +
# geom_rect(aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax),
#   fill = "khaki1", alpha = .5, color = "white") +
geom_line() +
geom_point(data = . %>% filter(i == R_i), size = 4) +
geom_point(data = . %>% filter(i == R_j), size = 4) +
geom_text(data = . %>% filter(i == R_i), aes(label = round(r, 1), y = ifelse(r > 0, r - .6, r + .6))) +
geom_text(data = . %>% filter(i == R_j), aes(label = round(r, 1), y = ifelse(r > 0, r - .6, r + .6))) +
geom_label(data = tmp, aes(label = G), color = "black") +
# annotate("text", x = 55, y = 1, label = round(G_k,1)) +
labs(x = "Week", y = "Moving window Correlation") +
facet_wrap(~tmp, ncol = 1, strip.position = "right") +
theme_classic() +
theme(legend.position = "none",
strip.text = element_text(face = "bold", angle = 0, size = rel(1.3)),
axis.text = element_text(face = "bold"),
axis.title = element_text(face = "bold", size = rel(1.2)))
}
loop.animate <- function() {
lapply(1:nrow(inner), function(i){
gausssim_short_plot_fun(inner$inner_l[i], inner$outer_l[i], inner$inner[i])
})
}
saveGIF(loop.animate(), interval = .1, movie.name="gaussim_series_short.gif", ani.width = 800, ani.height = 500)
loop.animate <- function() {
lapply(1:nrow(inner), function(i){
print(gausssim_short_plot_fun(inner$inner_l[i], inner$outer_l[i], inner$inner[i]))
})
}
saveGIF(loop.animate(), interval = .1, movie.name="gaussim_series_short.gif", ani.width = 800, ani.height = 500)
mw_cor %>%
mutate(xmin = 25, xmax = 35, ymin = -1, ymax = 1) %>%
ggplot(aes(x = i, y = r, color = tmp)) +
scale_y_continuous(limits = c(-1,1), breaks = seq(-1,1,1)) +
scale_x_continuous(limits = c(1,55), breaks = c(1,seq(5,55,5))) +
geom_rect(aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax),
fill = "khaki1", alpha = .5, color = "white") +
geom_line() +
labs(x = "Week", y = "Moving window Correlation") +
facet_wrap(~tmp, ncol = 1, strip.position = "right") +
theme_classic() +
theme(legend.position = "none",
strip.text = element_text(face = "bold", angle = 0, size = rel(1.3)),
axis.text = element_text(face = "bold"),
axis.title = element_text(face = "bold", size = rel(1.2)))
mw_cor %>%
mutate(xmin2 = 25, xmax2 = 35, ymin = -1, ymax = 1,
xmin1 = 6, xmax1 = 24, xmin3 = 36, xmax3 = 50) %>%
ggplot(aes(x = i, y = r, color = tmp)) +
scale_y_continuous(limits = c(-1,1), breaks = seq(-1,1,1)) +
scale_x_continuous(limits = c(1,55), breaks = c(1,seq(5,55,5))) +
geom_rect(aes(xmin = xmin2, xmax = xmax2, ymin = ymin, ymax = ymax),
fill = "khaki1", alpha = .5, color = "white") +
geom_rect(aes(xmin = xmin1, xmax = xmax1, ymin = ymin, ymax = ymax),
fill = "white", alpha = 0, color = "black") +
geom_rect(aes(xmin = xmin3, xmax = xmax3, ymin = ymin, ymax = ymax),
fill = "white", alpha = 0, color = "black") +
geom_line() +
labs(x = "Week", y = "Moving window Correlation") +
facet_wrap(~tmp, ncol = 1, strip.position = "right") +
theme_classic() +
theme(legend.position = "none",
strip.text = element_text(face = "bold", angle = 0, size = rel(1.3)),
axis.text = element_text(face = "bold"),
axis.title = element_text(face = "bold", size = rel(1.2)))
mw_cor %>%
mutate(xmin2 = 25, xmax2 = 35, ymin = -1, ymax = 1,
xmin1 = 6, xmax1 = 24, xmin3 = 36, xmax3 = 50) %>%
ggplot(aes(x = i, y = r, color = tmp)) +
scale_y_continuous(limits = c(-1,1), breaks = seq(-1,1,1)) +
scale_x_continuous(limits = c(1,55), breaks = c(1,seq(5,55,5))) +
geom_rect(aes(xmin = xmin2, xmax = xmax2, ymin = ymin, ymax = ymax),
fill = "khaki1", alpha = .5, color = "khaki1") +
geom_rect(aes(xmin = xmin1, xmax = xmax1, ymin = ymin, ymax = ymax),
fill = "white", alpha = 0, color = "black") +
geom_rect(aes(xmin = xmin3, xmax = xmax3, ymin = ymin, ymax = ymax),
fill = "white", alpha = 0, color = "black") +
geom_line() +
labs(x = "Week", y = "Moving window Correlation") +
facet_wrap(~tmp, ncol = 1, strip.position = "right") +
theme_classic() +
theme(legend.position = "none",
strip.text = element_text(face = "bold", angle = 0, size = rel(1.3)),
axis.text = element_text(face = "bold"),
axis.title = element_text(face = "bold", size = rel(1.2)))
mw_cor %>%
mutate(xmin2 = 25, xmax2 = 35, ymin = -1, ymax = 1,
xmin1 = 6, xmax1 = 24, xmin3 = 36, xmax3 = 50) %>%
ggplot(aes(x = i, y = r, color = tmp)) +
scale_y_continuous(limits = c(-1,1), breaks = seq(-1,1,1)) +
scale_x_continuous(limits = c(1,55), breaks = c(1,seq(5,55,5))) +
geom_rect(aes(xmin = xmin2, xmax = xmax2, ymin = ymin, ymax = ymax),
fill = "khaki1", alpha = .5, color = "khaki1") +
geom_rect(aes(xmin = xmin1, xmax = xmax1, ymin = ymin, ymax = ymax),
fill = "white", alpha = 0, color = "gray") +
geom_rect(aes(xmin = xmin3, xmax = xmax3, ymin = ymin, ymax = ymax),
fill = "white", alpha = 0, color = "gray") +
geom_line() +
labs(x = "Week", y = "Moving window Correlation") +
facet_wrap(~tmp, ncol = 1, strip.position = "right") +
theme_classic() +
theme(legend.position = "none",
strip.text = element_text(face = "bold", angle = 0, size = rel(1.3)),
axis.text = element_text(face = "bold"),
axis.title = element_text(face = "bold", size = rel(1.2)))
ggsave(sprintf("%s/results/pres_figs/mwr_series_ex_k2.png", write.path),
width = 8, height = 5)
quantile(nrow(data), .05)
data <- ex_dat
quantile(nrow(data), .05)
quantile(1:nrow(data), .05)
ceiling(quantile(1:nrow(data), .05))
data[c(1:(ceiling(quantile(1:nrow(data), .05)))),]
data %>% filter(week %in% ceiling(quantile(1:nrow(data), .05)))
data %>% filter(week %in% 1:ceiling(quantile(1:nrow(data), .05)))
data %>% filter(week %in% 1:ceiling(quantile(1:nrow(data), .05))) %>% select(-ID, -week)
floor(quantile(1:nrow(data), .95))
quantile(1:nrow(data), .95)
d_las_5 <- data %>% filter(week %in% (nrow(data)-floor(quantile(1:nrow(data), .95))):nrow(data)) %>% select(-ID, -week)
d_las_5
floor(quantile(1:nrow(data), .95))
data %>% filter(week %in% (floor(quantile(1:nrow(data), .95))):nrow(data)) %>% select(-ID, -week)
d_beg_5 <- data %>% filter(week %in% 1:ceiling(quantile(1:nrow(data), .05))) %>% select(-ID, -week)
v_beg <- cov(d_beg_5)
v_beg
v_las <- cov(d_las_5)
v_las
trace(cov(d_beg_5))
v_beg <- tr(cov(d_beg_5))
v_beg
v_las <- tr(cov(d_las_5))
v_las
phase_k1_fun <- function(tau){
start <- min(mw_cor$i); end <- max(mw_cor$i)
mw_cor %>%
mutate(xmin = start, xmax = tau, xmin2 = tau+1, xmax2 = end,
ymin = -1, ymax = 1) %>%
ggplot(aes(x = i, y = r, color = tmp)) +
scale_y_continuous(limits = c(-1,1), breaks = seq(-1,1,1)) +
scale_x_continuous(limits = c(1,55), breaks = c(1,seq(5,55,5))) +
geom_rect(aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax),
fill = "white", alpha = .5, color = "black") +
geom_rect(aes(xmin = xmin2, xmax = xmax2, ymin = ymin, ymax = ymax),
fill = "white", alpha = .5, color = "black") +
geom_line() +
labs(x = "Week", y = "Moving window Correlation") +
facet_wrap(~tmp, ncol = 1, strip.position = "right") +
theme_classic() +
theme(legend.position = "none",
strip.text = element_text(face = "bold", angle = 0, size = rel(1.3)),
axis.text = element_text(face = "bold"),
axis.title = element_text(face = "bold", size = rel(1.2)))
}
loop.animate <- function() {
lapply(9:47, function(i) {
print(mw_plot_fun(i))
})
}
saveGIF(loop.animate(), interval = .25, movie.name="mwr_phases.gif", ani.width = 800, ani.height = 500)
loop.animate <- function() {
lapply(9:47, function(i) {
print(phase_k1_fun(i))
})
}
saveGIF(loop.animate(), interval = .25, movie.name="mwr_phases.gif", ani.width = 800, ani.height = 500)
ex_dat
tibble(sample = 1:50) %>%
mutate(perm_data = map(sample, ~sample_n(ex_dat, nrow(ex_dat), replace = F)))
perm <- tibble(sample = 1:50) %>%
mutate(perm_data = map(sample, ~sample_n(ex_dat, nrow(ex_dat), replace = F)))
perm$perm_data[[1]]
perm <- tibble(sample = 1:50) %>%
mutate(perm_data = map(sample, ~sample_n(ex_dat %>% select(-ID, -week), nrow(ex_dat), replace = F)),
mw_cor = map(perm_data, mw_cor_fun))
perm
mw_perm <- perm %>% unnest(mw_cor)
mw_perm
mw_perm_plot_fun <- function(s){
mw_perm %>%
filter(sample <= s) %>%
ggplot(aes(x = i, y = r, color = sample)) +
scale_y_continuous(limits = c(-1,1), breaks = seq(-1,1,1)) +
scale_x_continuous(limits = c(1,55), breaks = c(1,seq(5,55,5))) +
geom_line() +
labs(x = "Week", y = "Moving window Correlation") +
facet_wrap(~tmp, ncol = 1, strip.position = "right") +
theme_classic() +
theme(legend.position = "none",
strip.text = element_text(face = "bold", angle = 0, size = rel(1.3)),
axis.text = element_text(face = "bold"),
axis.title = element_text(face = "bold", size = rel(1.2)))
}
mw_perm_plot_fun <- function(s){
mw_perm %>%
filter(sample <= s) %>%
ggplot(aes(x = i, y = r, color = sample)) +
scale_y_continuous(limits = c(-1,1), breaks = seq(-1,1,1)) +
scale_x_continuous(limits = c(1,55), breaks = c(1,seq(5,55,5))) +
geom_line() +
labs(x = "Week", y = "Moving window Correlation") +
facet_wrap(~tmp, ncol = 1, strip.position = "right") +
theme_classic() +
theme(legend.position = "none",
strip.text = element_text(face = "bold", angle = 0, size = rel(1.3)),
axis.text = element_text(face = "bold"),
axis.title = element_text(face = "bold", size = rel(1.2)))
}
loop.animate <- function() {
lapply(1:50, function(i) {
print(mw_perm_plot_fun(i))
})
}
saveGIF(loop.animate(), interval = .25, movie.name="mwr_perm.gif", ani.width = 800, ani.height = 500)
debug(mw_perm_plot_fun)
mw_perm
perm <- tibble(sample = 1:50) %>%
mutate(perm_data = map(sample, ~sample_n(ex_dat %>% select(-ID, -week), nrow(ex_dat), replace = F)),
mw_cor = map(perm_data, ~mw_cor_fun(., window = 10)))
mw_perm <- perm %>% unnest(mw_cor) %>%
mutate(V1 = mapvalues(V1, Big5, c("E", "A", "C", "N", "O")),
V2 = mapvalues(V2, Big5, c("E", "A", "C", "N", "O"))) %>%
unite(tmp, V1, V2, sep = "-")
mw_perm_plot_fun <- function(s){
mw_perm %>%
filter(sample <= s) %>%
ggplot(aes(x = i, y = r, color = sample)) +
scale_y_continuous(limits = c(-1,1), breaks = seq(-1,1,1)) +
scale_x_continuous(limits = c(1,55), breaks = c(1,seq(5,55,5))) +
geom_line() +
labs(x = "Week", y = "Moving window Correlation") +
facet_wrap(~tmp, ncol = 1, strip.position = "right") +
theme_classic() +
theme(legend.position = "none",
strip.text = element_text(face = "bold", angle = 0, size = rel(1.3)),
axis.text = element_text(face = "bold"),
axis.title = element_text(face = "bold", size = rel(1.2)))
}
mw_cor
mw_perm_plot_fun <- function(s){
mw_perm %>%
filter(sample <= s) %>%
ggplot(aes(x = i, y = r, color = sample)) +
scale_y_continuous(limits = c(-1,1), breaks = seq(-1,1,1)) +
scale_x_continuous(limits = c(1,55), breaks = c(1,seq(5,55,5))) +
geom_line() +
labs(x = "Week", y = "Moving window Correlation") +
facet_wrap(~tmp, ncol = 1, strip.position = "right") +
theme_classic() +
theme(legend.position = "none",
strip.text = element_text(face = "bold", angle = 0, size = rel(1.3)),
axis.text = element_text(face = "bold"),
axis.title = element_text(face = "bold", size = rel(1.2)))
}
loop.animate <- function() {
lapply(1:50, function(i) {
print(mw_perm_plot_fun(i))
})
}
saveGIF(loop.animate(), interval = .25, movie.name="mwr_perm.gif", ani.width = 800, ani.height = 500)
mw_perm <- perm %>% unnest(mw_cor) %>%
mutate(V1 = mapvalues(V1, Big5, c("E", "A", "C", "N", "O")),
V2 = mapvalues(V2, Big5, c("E", "A", "C", "N", "O")),
sample = as.character(sample)) %>%
unite(tmp, V1, V2, sep = "-")
mw_perm_plot_fun <- function(s){
mw_perm %>%
filter(sample <= s) %>%
ggplot(aes(x = i, y = r, color = sample)) +
scale_y_continuous(limits = c(-1,1), breaks = seq(-1,1,1)) +
scale_x_continuous(limits = c(1,55), breaks = c(1,seq(5,55,5))) +
geom_line() +
labs(x = "Week", y = "Moving window Correlation") +
facet_wrap(~tmp, ncol = 1, strip.position = "right") +
theme_classic() +
theme(legend.position = "none",
strip.text = element_text(face = "bold", angle = 0, size = rel(1.3)),
axis.text = element_text(face = "bold"),
axis.title = element_text(face = "bold", size = rel(1.2)))
}
loop.animate <- function() {
lapply(1:50, function(i) {
print(mw_perm_plot_fun(i))
})
}
saveGIF(loop.animate(), interval = .25, movie.name="mwr_perm.gif", ani.width = 800, ani.height = 500)
mw_perm_plot_fun <- function(s){
mw_perm %>%
filter(as.numeric(sample) <= s) %>%
ggplot(aes(x = i, y = r, color = sample)) +
scale_y_continuous(limits = c(-1,1), breaks = seq(-1,1,1)) +
scale_x_continuous(limits = c(1,55), breaks = c(1,seq(5,55,5))) +
geom_line() +
labs(x = "Week", y = "Moving window Correlation") +
facet_wrap(~tmp, ncol = 1, strip.position = "right") +
theme_classic() +
theme(legend.position = "none",
strip.text = element_text(face = "bold", angle = 0, size = rel(1.3)),
axis.text = element_text(face = "bold"),
axis.title = element_text(face = "bold", size = rel(1.2)))
}
loop.animate <- function() {
lapply(1:50, function(i) {
print(mw_perm_plot_fun(i))
})
}
saveGIF(loop.animate(), interval = .25, movie.name="mwr_perm.gif", ani.width = 800, ani.height = 500)
